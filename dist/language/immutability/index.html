<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="/icons/icon.png"
      media="(prefers-color-scheme: light)"
    />
    <link
      rel="icon"
      href="/icons/icon-light.png"
      media="(prefers-color-scheme: dark)"
    />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <title>Language Reference: Immutability</title>
  </head>

  <body>
    <header>
      <a id="logo" href="/">
        <img src="/icons/icon.svg" />
        Pointless
      </a>

      <nav>
        <ul>
          <li><a href="/intro/">Intro</a></li>
          <li><a href="/philosophy/">Philosophy</a></li>
          <li><a href="/language/">Language</a></li>
          <li><a href="/stdlib/">Standard Library</a></li>
          <li><a href="/articles/">Articles</a></li>
        </ul>
      </nav>
    </header>

    <article>
      <div id="title">
        <h1>Language Reference: Immutability</h1>
        <p>null</p>
      </div>

      <div id="sidebar">
        <a id="back" href="..">< Back to Language Reference</a>
        <ol>
          <li><a href="#structural-updates"> Structural Updates</a></li>
        </ol>
      </div>

      <main>
        <hr />

        <h2 id="structural-updates">
          <a href="#structural-updates">Structural Updates</a>
        </h2>
        <p>
          <em
            >Note: the following section covers one of the more subtle and
            significant features of Pointless. You can learn more about the
            development of this language feature
            <a href="/articles/solving-structural-updates/">here</a>.</em
          >
        </p>
        <p>
          In Pointless, we can use assignment syntax to update
          <a href="/language/lists/#updates">lists</a>,
          <a href="/language/objects/#updates">objects</a>, and
          <a href="/language/tables/#updates">tables</a>.
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls">hero <span class="operator">=</span> { name: <span class="quotes">&quot;</span><span class="string">Lilah</span><span class="quotes">&quot;</span>, score: <span class="number">0</span>, items: [<span class="constant">none</span>] }

hero.score <span class="operator">+=</span> <span class="number">1</span> <span class="comment">-- Increment the `score` value in `hero`</span>
hero.items[<span class="number">0</span>] <span class="operator">=</span> <span class="quotes">&quot;</span><span class="string">food</span><span class="quotes">&quot;</span> <span class="comment">-- Replace the first value in the `items` list in `hero`</span></code></pre>

          <pre
            class="result"
            style="undefined"
          ><code><div class="var-name">hero</div>{ name: &quot;Lilah&quot;, score: 1, items: [&quot;food&quot;] }</code></pre>
        </div>
        <p>
          This update syntax looks similar to what you&#39;d see in other
          scripting languages like JavaScript or Python, but there&#39;s an
          important difference: data structures in Pointless are
          <em>immutable</em>. When the language evaluates these two lines:
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls">hero.score <span class="operator">+=</span> <span class="number">1</span>
hero.items[<span class="number">0</span>] <span class="operator">=</span> <span class="quotes">&quot;</span><span class="string">food</span><span class="quotes">&quot;</span></code></pre>
        </div>
        <p>
          the underlying object and list aren&#39;t modified directly. Instead,
          the language makes copies of the data structures with the new values
          inserted, and reassigns the variable <code>hero</code> to reference
          those new structures. We could rewrite the code above using the setter
          functions <code>Obj.set</code> and <code>List.set</code>, which make
          this process more explicit, but which ultimately do the same thing.
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls">hero <span class="operator">=</span> <span class="std">Obj</span>.<span class="call">set</span>(hero, <span class="quotes">&quot;</span><span class="string">score</span><span class="quotes">&quot;</span>, hero.score <span class="operator">+</span> <span class="number">1</span>)
hero <span class="operator">=</span> <span class="std">Obj</span>.<span class="call">set</span>(hero, <span class="quotes">&quot;</span><span class="string">items</span><span class="quotes">&quot;</span>, <span class="std">List</span>.<span class="call">set</span>(hero.items, <span class="number">0</span>, <span class="quotes">&quot;</span><span class="string">food</span><span class="quotes">&quot;</span>))</code></pre>
        </div>
        <p>
          In Pointless, <strong>variables</strong> are
          <strong>mutable</strong> and <strong>data</strong> is
          <strong>immutable</strong>. This is similar in principle to the
          <em>copy on write</em> behavior found in some imperative languages.
        </p>
        <p>
          Why does this distinction matter? To demonstrate, let&#39;s make a
          second variable <code>twin</code> referencing our original
          <code>hero</code> object before any modifications. After we update
          <code>hero</code>, we can see that our updates only modified the
          <code>hero</code> variable, while <code>twin</code> remains unchanged.
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls">hero <span class="operator">=</span> { name: <span class="quotes">&quot;</span><span class="string">Lilah</span><span class="quotes">&quot;</span>, score: <span class="number">0</span>, items: [<span class="constant">none</span>] }
twin <span class="operator">=</span> hero

hero.score <span class="operator">+=</span> <span class="number">1</span>
hero.items[<span class="number">0</span>] <span class="operator">=</span> <span class="quotes">&quot;</span><span class="string">food</span><span class="quotes">&quot;</span>

hero
twin</code></pre>
          <pre
            class="result"
            style="undefined"
          ><code>{ name: &quot;Lilah&quot;, score: 1, items: [&quot;food&quot;] }
{ name: &quot;Lilah&quot;, score: 0, items: [none] }
</code></pre>
        </div>
        <p>
          This property of Pointless means that you don&#39;t have to worry
          about <em>variable aliasing</em> issues like you would in other
          languages. It also mean that functions which update data structures
          must return those updated structures for the changes to be visible
          outside those functions. For example, the function below does nothing:
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls"><span class="keyword">fn</span> <span class="function">incScore</span>(<span class="argument">person</span>)
  <span class="comment">-- Updated `person` is only visible within `incScore`</span>
  person.score <span class="operator">+=</span> <span class="number">1</span>
<span class="keyword">end</span></code></pre>
        </div>
        <p>
          because, while it updates the local variable <code>person</code>, the
          updated object is only visible within the function
          <code>incScore</code>. For <code>incScore</code> to be useful, it
          needs to return the updated <code>person</code> object.
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls"><span class="keyword">fn</span> <span class="function">incScore</span>(<span class="argument">person</span>)
  person.score <span class="operator">+=</span> <span class="number">1</span>
  person
<span class="keyword">end</span>

hero <span class="operator">=</span> { name: <span class="quotes">&quot;</span><span class="string">Lilah</span><span class="quotes">&quot;</span>, score: <span class="number">0</span>, items: [<span class="constant">none</span>] }
hero <span class="operator">|=</span> <span class="call">incScore</span></code></pre>

          <pre
            class="result"
            style="undefined"
          ><code><div class="var-name">hero</div>{ name: &quot;Lilah&quot;, score: 1, items: [none] }</code></pre>
        </div>
        <p>
          Note that, because structural update work by redefining variables, the
          leftmost target of the update must be a variable name.
        </p>

        <div class="snippet undefined">
          <pre><code class="ptls"><span class="keyword">fn</span> <span class="function">getHero</span>()
  { name: <span class="quotes">&quot;</span><span class="string">Lilah</span><span class="quotes">&quot;</span>, score: <span class="number">0</span>, items: [<span class="constant">none</span>] }
<span class="keyword">end</span>

<span class="comment">-- Incorrect, can&#039;t update a function call</span>
<span class="call">getHero</span>().score <span class="operator">+=</span> <span class="number">1</span></code></pre>

          <pre
            class="result panic"
          ><code>panic: assignment target must be a variable name

getHero().score += 1
       ^
At pages/language/immutability/index.md:embedded:6:8</code></pre>
        </div>
        <p>ref</p>

        <div id="sequencer">
          <hr />
          <div>
            <a href="/language/equality">
              <div>< Previous</div>
              Equality
            </a>

            <a class="next" href="/language/conditionals">
              <div>Next ></div>
              Conditionals
            </a>
          </div>
        </div>
      </main>
    </article>
  </body>
</html>
